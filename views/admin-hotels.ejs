<%- layout('./layouts/boilerplate') %>

<link rel="stylesheet" href="/css/admin.css">

<div class="admin-wrapper">
  <!-- Sidebar -->
  <div class="admin-sidebar" id="adminSidebar">
    <div class="sidebar-header">
      <h3><i class="fas fa-tachometer-alt me-2"></i>Admin Panel</h3>
    </div>
    <nav class="sidebar-nav">
      <div class="nav-item">
        <a href="/admin" class="nav-link" data-page="dashboard">
          <i class="fas fa-chart-pie"></i>
          <span>Dashboard</span>
        </a>
      </div>
      <div class="nav-item">
        <a href="/admin/hotels" class="nav-link active" data-page="hotels">
          <i class="fas fa-hotel"></i>
          <span>Hotel Management</span>
        </a>
      </div>
      <div class="nav-item">
        <a href="/admin/users" class="nav-link" data-page="users">
          <i class="fas fa-users"></i>
          <span>User Management</span>
        </a>
      </div>
      <div class="nav-item">
        <a href="/admin/messages" class="nav-link" data-page="messages">
          <i class="fas fa-envelope"></i>
          <span>Messages</span>
        </a>
      </div>
      <div class="nav-item">
        <a href="/listings" class="nav-link">
          <i class="fas fa-home"></i>
          <span>Back to Home</span>
        </a>
      </div>
      <div class="nav-item" style="margin-top: 2rem; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 1rem;">
        <a href="/logout" class="nav-link">
          <i class="fas fa-sign-out-alt"></i>
          <span>Logout</span>
        </a>
      </div>
    </nav>
  </div>

  <!-- Main Content -->
  <div class="admin-content" id="adminContent">
    <div class="admin-page py-4">
      <div class="admin-header d-flex align-items-center justify-content-between mb-4">
        <div>
          <h1 class="h3 mb-1">Hotel Management</h1>
          <p class="text-muted mb-0">Manage all hotels and listings</p>
        </div>
        <div class="d-flex gap-2">
          <span class="badge bg-primary"><%= hotels.length %> Hotels</span>
        </div>
      </div>

      <div class="management-table">
        <div class="table-responsive">
          <table class="table mb-0 align-middle">
            <thead>
              <tr>
                <th scope="col">Hotel</th>
                <th scope="col">Owner</th>
                <th scope="col">Location</th>
                <th scope="col">Price</th>
                <th scope="col">Bookings</th>
                <th scope="col">Revenue</th>
                <th scope="col">Rating</th>
                <th scope="col">Status</th>
                <th scope="col">Actions</th>
              </tr>
            </thead>
            <tbody>
              <% if (hotels && hotels.length > 0) { %>
                <% hotels.forEach(hotel => { %>
                  <tr>
                    <td>
                      <div>
                        <div class="fw-semibold"><%= hotel.title %></div>
                        <small class="text-muted">ID: <%= hotel._id.toString().slice(-6) %></small>
                      </div>
                    </td>
                    <td>
                      <div>
                        <div class="fw-semibold"><%= hotel.owner ? hotel.owner.username : 'Unknown' %></div>
                        <small class="text-muted"><%= hotel.owner ? hotel.owner.email : 'N/A' %></small>
                      </div>
                    </td>
                    <td><%= hotel.location %></td>
                    <td class="fw-semibold">₹<%= hotel.price %></td>
                    <td>
                      <span class="badge bg-info"><%= hotel.bookingCount %></span>
                    </td>
                    <td class="fw-semibold text-success">₹<%= hotel.revenue %></td>
                    <td>
                      <% if (hotel.reviews && hotel.reviews.length > 0) { %>
                        <% let avgRating = hotel.reviews.reduce((sum, review) => sum + review.rating, 0) / hotel.reviews.length %>
                        <span class="badge bg-warning text-dark">
                          <i class="fas fa-star"></i> <%= avgRating.toFixed(1) %>
                        </span>
                      <% } else { %>
                        <span class="text-muted">No reviews</span>
                      <% } %>
                    </td>
                    <td>
                      <% let daysSinceUpdate = Math.floor((Date.now() - new Date(hotel.lastUpdated)) / (1000 * 60 * 60 * 24)) %>
                      <% if (daysSinceUpdate < 30) { %>
                        <span class="badge bg-success">Active</span>
                      <% } else if (daysSinceUpdate < 45) { %>
                        <span class="badge bg-warning text-dark">Warning</span>
                      <% } else { %>
                        <span class="badge bg-danger">Inactive</span>
                      <% } %>
                    </td>
                    <td>
                      <div class="action-buttons">
                        <a href="/listings/<%= hotel._id %>" class="btn btn-view btn-action" target="_blank">
                          <i class="fas fa-eye"></i>
                        </a>
                        <a href="/listings/<%= hotel._id %>/edit" class="btn btn-edit btn-action">
                          <i class="fas fa-edit"></i>
                        </a>
                        <form method="POST" action="/admin/hotels/<%= hotel._id %>?_method=DELETE" style="display: inline;">
                          <button type="submit" class="btn btn-delete btn-action" 
                                  onclick="return confirm('Are you sure you want to delete this hotel?')">
                            <i class="fas fa-trash"></i>
                          </button>
                        </form>
                      </div>
                    </td>
                  </tr>
                <% }) %>
              <% } else { %>
                <tr>
                  <td colspan="9" class="text-center text-muted py-4">
                    <i class="fas fa-hotel fa-3x mb-3 d-block text-muted opacity-50"></i>
                    <h5>No hotels found</h5>
                    <p>There are no hotels in the system yet.</p>
                  </td>
                </tr>
              <% } %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // Admin hotels page is ready
</script>